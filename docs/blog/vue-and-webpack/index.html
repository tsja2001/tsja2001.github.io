<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta property="og:title" content="Vue.js 和 Webpack" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://lutaonan.com/blog/vue-and-webpack/" />
  <link rel="stylesheet" href="/styles/main.css">
  <link rel="me" href="https://mas.to/@djyde">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.27.0/themes/prism.min.css">
  
  <title>Vue.js 和 Webpack | Tsja&#39;s Blog</title>
  
  <script async defer data-website-id="a7250fef-ff01-4734-a866-6f0eb1c6e7a0" src="https://a.taonan.lu/ana.js"></script>
</head>
<body>
  
<div>
  <div class="container mx-auto prose py-12 sm:py-24 px-12 sm:px-0">
    <div class="mb-12">
      <a class="no-underline font-bold" href="/">Tsja&#39;s Blog</a>
    </div>
    <h1>Vue.js 和 Webpack</h1>
    <div class="italic text-gray-500">
      2015/08/29
    </div>
    <div>
      <nav class="table-of-contents"><ol><li><a href="#about-vue.js">About Vue.js</a></li><li><a href="#why-vue.js">Why Vue.js</a></li><li><a href="#using-vue.js">Using Vue.js</a><ol><li><a href="#%E7%BB%84%E4%BB%B6%E5%8C%96">组件化</a></li><li><a href="#%E8%B7%AF%E7%94%B1">路由</a></li></ol></li><li><a href="#about-webpack">About Webpack</a></li><li><a href="#using-webpack">Using Webpack</a><ol><li><a href="#%E5%A4%9A%E5%85%A5%E5%8F%A3%E6%96%87%E4%BB%B6">多入口文件</a></li><li><a href="#loader">loader</a></li></ol></li><li><a href="#why-vue.js-%2B-webpack">Why Vue.js + Webpack</a></li><li><a href="#using-vue.js-%2B-webpack">Using Vue.js + Webpack</a><ol><li><a href="#css-%E5%88%86%E7%A6%BB">css 分离</a></li></ol></li><li><a href="#%E6%80%BB%E7%BB%93">总结</a></li><li><a href="#%E5%BB%B6%E4%BC%B8%E9%98%85%E8%AF%BB">延伸阅读</a></li></ol></nav><p><strong>转载前请务必先联系邮箱</strong></p>
<p>最近在把 SISE Game（我们学校的校内游戏直播网站） 从原本的 Ruby on Rails 彻底用 Node.js 重写，  经过一些考虑，决定用 Vue.js 和 Express.js 实现前后端分离的架构，在这几天的重写过程中，积累了对 Webpack 和 Vue.js 的一些新的看法。</p>
<h2 id="about-vue.js" tabindex="-1">About Vue.js</h2>
<p>Vue 是个很年轻的 MVVM Library，常常有很多人用 Angular 和 Vue 比较，因为两者都是 MVVM，但实际上，前者是 Framework，而后者是 Library。前者有很陡峭的学习曲线，后者可以很快地掌握运用到项目中去。</p>
<p>Vue 的官方是用 <strong>a library for building modern web interfaces</strong> 来描述自己的。Vue 适合和 React 对比，因为在使用 Vue 的 Components System 开发比较大型的 Single Page Application 的时候，我发现它和 React 有一些相似的地方。如果你赞同 React 的思想，但又不想写 JSX，那么，你就可能需要试试 Vue 了。</p>
<p>一个用 Vue 实现 Data binding 的 Demo：</p>
<pre class="language-html"><code class="language-html"><span class="token comment">&lt;!-- index.html --></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>msg<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>{{ msg }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>  <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>    <span class="token literal-property property">el</span><span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span><br>    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>      <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'hello Vue.js'</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre>
<h2 id="why-vue.js" tabindex="-1">Why Vue.js</h2>
<p>前端开发发展到现在，我们做过的很多努力，都是在尝试把开发者从繁琐的 DOM  操作和管理 DOM state 中解放出去，我们希望只需要通过描述数据和行为，DOM 自己就可以发生对应的变化，React 在 View 这一层实现了这一目标，而 MVVM 则是通过 ViewModel 的 Data Binding。React 宣称自己是 View，那么在我看来， Vue 则是 View + ViewModel，并且 Vue 更加 lightweight 和 flexible。</p>
<p>Vue 最让我喜欢的是它的 Components System，利用它可以构建组件化的中大型应用。React 当然也是组件化的，但是 Virtual DOM (JSX) 在一些场景让我很不满意。比如有一次，我用一个使用 React 的项目中，想要在一 <code>&lt;video&gt;</code> 里使用 <code>webkit-playsinline</code> 这个 attribute，但是 React 不支持，渲染的时候直接被 ignored，我必须手动地操作 DOM 给 <code>&lt;video&gt;</code> setAttribute。相反，Vue 的 Components System 当中，写的是真正的 DOM，不需要担心不支持不兼容的各种情况。</p>
<p>容易被用作对比的是 Angular。我第一次听说 Vue 的时候，也是把它当作一个 lightweight 的 Angular alternative. 但是当真正实践使用 Vue 的时候，才发现它和 Angular 有着很大的不同。Angular 是一个 Framework，一旦你使用它，就必须按照它的一套去组织你的项目。以前写 Angular 项目的过程和经历对我个人来说都不太愉快，我更加倾向于 Vue 这种更灵活的方案。</p>
<p>关于 Vue 和其它库和框架的对比，官方也有作者更详细的 <a href="http://vuejs.org/guide/faq.html">解答</a>（<a href="http://cn.vuejs.org/guide/faq.html">中文版本</a>）</p>
<h2 id="using-vue.js" tabindex="-1">Using Vue.js</h2>
<p>SISE Game 并不算一个大型的 Web APP，但也规范地使用组件化的开发，整个项目的结构大致如下：</p>
<pre class="language-text"><code class="language-text">├── app<br>│   ├── app.js #entry<br>│   ├── app.vue<br>│   ├── config.js <br>│   ├── filters # 自定义的一些 filters<br>│   ├── components #各种组件<br>│   ├── models<br>│   ├── utils<br>│   └── views #各种页面的 views<br>│       ├── home.vue<br>│       ├── room.vue<br>│       ├── signin.vue<br>│       ├── signup.vue<br>│       └── user.vue<br>├── bower.json<br>├── build<br>├── gulpfile.js<br>├── index.html<br>├── node_modules<br>├── package.json<br>├── static #静态文件<br>│   ├── images<br>│   ├── styles<br>│   └── swfs<br>└── webpack.config.js</code></pre>
<h3 id="%E7%BB%84%E4%BB%B6%E5%8C%96" tabindex="-1">组件化</h3>
<p>Vue 通过自己的 <code>.vue</code> 文件来定义 components，<code>.vue</code> 文件里包含组件的模板、逻辑和样式，从而实现组件和组件之间的<strong>分治</strong>，非常易于维护。</p>
<pre class="language-html"><code class="language-html"><span class="token comment">&lt;!-- components/user.vue --></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Hello {{ name }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">v-on</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>click: alertName()<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>alert!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span><br>    <span class="token function-variable function">data</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>      <span class="token keyword">return</span> <span class="token punctuation">{</span><br>        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Randy'</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>      <span class="token function-variable function">alertName</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"><br>  <span class="token selector">p</span><span class="token punctuation">{</span><br>    <span class="token property">color</span><span class="token punctuation">:</span> #69C<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code></pre>
<p>以上就是一个简单的 component 实现，借助 webpack，甚至可以直接在 component 里写 es6、scss 和 jade。</p>
<h3 id="%E8%B7%AF%E7%94%B1" tabindex="-1">路由</h3>
<p>路由对于 Single Page Application 来说应该算是不可少的东西，Vue 作为一个 Library，它本身并不提供这些组件。目前官方的 vue-router 仍处于 technical preview 的状态，官方也建议可以使用 component 和 Director.js 实现路由，比如：</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name">is</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ currentView }}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre>
<pre class="language-javascript"><code class="language-javascript">Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'home'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><br>Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'page1'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  <span class="token literal-property property">el</span><span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token literal-property property">currentView</span><span class="token operator">:</span> <span class="token string">'home'</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token comment">// Switching pages in your route handler:</span><br>app<span class="token punctuation">.</span>currentView <span class="token operator">=</span> <span class="token string">'page1'</span></code></pre>
<p>这样你只需要操作 <code>app.currentView</code> 的值就可以实现视图的切换，这一步通常会配合 Director.js 这类的 hash router.</p>
<h2 id="about-webpack" tabindex="-1">About Webpack</h2>
<p>与其费周章说明 Webpack 是什么东西，倒不如先说说不用 Webpack 以前的一些现实。</p>
<p>我们在写前端 JavaScript 的时候，通常是写在多个 <code>.js</code> 文件里，通过闭包避免全局变量污染，然后一股脑地用 <code>&lt;script&gt;</code> 引入。</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><br>  ...<br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>a.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>b.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>c.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></code></pre>
<p>出于性能上的追求，我们会应该把 <code>a.js</code> <code>b.js</code> <code>c.js</code> 合并为同一个文件 <code>bundle.js</code> 来减少请求数量，变成：</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><br>  ...<br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bundle.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></code></pre>
<p>使用 Gulp/Grunt 等自动化构建工具很容易可以实现这样的 concat，但是很快我们就会发现，单纯的 concat 并不是一个好的方案，因为代码文件之间的依赖关系不明确，这样一来，有时不得不花一些时间去组织 concat 的顺序。我们很希望像写 Node 一样模块化地去写前端 JavaScript。</p>
<p>又有些时候，在两个不同的页面当中我们常常会共用一些代码，单纯的 concat 会增加很多不必要的体积。</p>
<p>所以  ，我们理想的情况是，可以在前端优雅地写符合模块规范（AMD, UMD, CommonJS）的代码并且自动打包，最好还能自动把重用的文件分离出来。</p>
<p>嘿，Webpack 就很擅长做这种事。</p>
<h2 id="using-webpack" tabindex="-1">Using Webpack</h2>
<p>Webpack 兼容所有模块规范（如果你不知道到底用哪一种，就用 CommonJS）。</p>
<p>配置 webpack 比较简单，你需要定义入口文件和 bundle 输出的目录：</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// webpack.config.js</span><br>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span><br>  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">'./app.js'</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'./build'</span><span class="token punctuation">,</span><br>    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'bundle.js'</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>这样，你就能在前端这样去写 JavaScript：</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// /app.js</span><br><span class="token keyword">var</span> Vue <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'vue'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token comment">/*...*/</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>这是 CommonJS 的写法，如果你写过 Node.js，应该对这种写法相当熟悉。这时运行 <code>$ webpack</code> ，webpack 会自动根据入口文件 <code>app.js</code> 中的依赖关系来打包成单个 js 文件，输出到配置文件中指定的 output path 中。</p>
<p>webpack 也可以通过 plugin 自动分析重用的模块并且打包成单独的文件：</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// webpack.config.js</span><br><span class="token keyword">var</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>  CommonsChunkPlugin <span class="token operator">=</span> webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>CommonsChunkPlugin<br><br>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span><br>  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">'./app.js'</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'./build'</span><span class="token punctuation">,</span><br>    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'bundle.js'</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>    <span class="token keyword">new</span> <span class="token class-name">CommonsChunkPlugin</span><span class="token punctuation">(</span><span class="token string">'vendor.js'</span><span class="token punctuation">)</span><br>  <span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre>
<h3 id="%E5%A4%9A%E5%85%A5%E5%8F%A3%E6%96%87%E4%BB%B6" tabindex="-1">多入口文件</h3>
<p>webpack 的一个特色是可以指定多个入口文件，最后打包成多个 bundle。比如说 Timeline page 和 Profile page 是不同的页面，我们不希望两个页面的 js 被打包在一起，这时我们就可以为 timeline 和 profile 两个页面定义不同的入口：</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// webpack.config.js</span><br>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span><br>  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token literal-property property">timeline</span><span class="token operator">:</span> <span class="token string">'./timeline.js'</span><span class="token punctuation">,</span><br>    <span class="token literal-property property">profile</span><span class="token operator">:</span> <span class="token string">'./profile.js'</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'./build'</span><span class="token punctuation">,</span><br>    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'[name].bundle.js'</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>    <span class="token keyword">new</span> <span class="token class-name">CommonsChunkPlugin</span><span class="token punctuation">(</span><span class="token string">'vendor.js'</span><span class="token punctuation">)</span><br>  <span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre>
<p>最后会被分别打包成 <code>timeline.bundle.js</code> 和 <code>profile.bundle.js</code>。</p>
<h3 id="loader" tabindex="-1">loader</h3>
<p>webpack 神奇的地方在于，任何的文件都能被 <code>require()</code>。依靠各种 loader，使你可以直接 <code>require()</code> 样式、图片等静态文件。这些静态文件最后都会被处理（比如 scss pre-process 和图片的压缩）和打包在配置好的 output path 中。</p>
<pre class="language-scss"><code class="language-scss"><span class="token selector">#container</span><span class="token punctuation">{</span><br>  <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token url">url</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'.https://gbstatic.djyde.com/blog/background.png'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token selector">p</span><span class="token punctuation">{</span><br>    <span class="token property">color</span><span class="token punctuation">:</span> #69C<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// app.js</span><br><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./styles/app.scss'</span><span class="token punctuation">)</span><br><span class="token comment">// blablabla....</span></code></pre>
<p>你可以像上面这样在 JavaScript 中引入 scss （和在样式中引入图片），只要你配置好处理 scss 的 loader：</p>
<pre class="language-javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span><br>  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">'./app.js'</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'./build'</span><span class="token punctuation">,</span><br>    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'bundle.js'</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token literal-property property">loaders</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>      <span class="token punctuation">{</span><br>        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(css|scss)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span><br>        <span class="token literal-property property">loader</span><span class="token operator">:</span> ExtractTextPlugin<span class="token punctuation">.</span><span class="token function">extract</span><span class="token punctuation">(</span><span class="token string">'style'</span><span class="token punctuation">,</span><span class="token string">'css!sass'</span><span class="token punctuation">)</span><br>      <span class="token punctuation">}</span><span class="token punctuation">,</span><br>      <span class="token punctuation">{</span><br>        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(png|jpg)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span><br>        <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'url?limit=8192'</span> <span class="token comment">// 图片低于 8MB 时转换成 inline base64，非常神奇！</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">]</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>css 默认被编译到 JavaScript 中成为字符串后再被插入到 <code>&lt;style&gt;</code> 中，我个人建议使用 <code>ExtractTextPlugin</code> 这个插件把 css 分离出去。</p>
<h2 id="why-vue.js-%2B-webpack" tabindex="-1">Why Vue.js + Webpack</h2>
<p>在以往的一些小型的前端项目中，我习惯把逻辑（<code>scripts</code>）、视图（<code>views</code>）和样式（<code>styles</code>）分开在独立的目录当中，保证三者不耦合在一起。但是随着项目越来越大，这样的结构会让开发越来越痛苦，比如要增加或修改某个 <code>view</code> 的时候，就要在 <code>scripts</code> 和 <code>sytles</code> 里找到对应这个 <code>view</code> 的逻辑和样式进行修改。</p>
<p>为了避免这样随着项目增大带来的难于维护，我开始尝试<strong>前端组件化</strong>，把 <code>views</code> 拆分成不同的组件（component），为单个组件编写对应的逻辑和样式：</p>
<pre><code>app/components
├── Chat
│   ├── Chat.jade
│   ├── Chat.js
│   └── Chat.scss
└── Video
    ├── Video.jade
    ├── Video.js
    └── Video.scss
</code></pre>
<p>这样的开发模式，不仅提高代码的可维护性和可重用性，还有利于团队之间的协作，一个组件由一个人去维护，更好地实现<strong>分治</strong>。幸运的是，随着 React 越来越火，组件化的开发模式也就越来越被接受。</p>
<h2 id="using-vue.js-%2B-webpack" tabindex="-1">Using Vue.js + Webpack</h2>
<p>在 Vue 中，可以利用一个 <code>.vue</code> 文件实现组件化，而不需要对每个组件分别建立 style, scripts 和 view。这样做的好处是使组件能更加直观，而坏处是目前有些 editor 对 <code>.vue</code> 的语法支持还是不太好。我用 Atom 写 <code>.vue</code> 的时候，<code>&lt;style&gt;</code> 的那一块并不能自动补全。不过我个人不依赖 css 的补全，所以没有太大的影响。如果你比较依赖这个，建议你还是把这些代码分离出来。</p>
<p>一个简单的 Vue Component：</p>
<pre class="language-html"><code class="language-html"><span class="token comment">&lt;!-- components/sample.vue --></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>jade<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  .test<br>    h1 hello {{msg}}<br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span><br>  <span class="token literal-property property">el</span><span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'world'</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sass<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"><br>  <span class="token selector">.test</span><span class="token punctuation">{</span><br>    <span class="token selector">h1</span><span class="token punctuation">{</span><br>      <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code></pre>
<p>我们使用 Webpack 就可以自动将 <code>.vue</code> 文件编译成正常的 JavaScript 代码，只需要在 Webpack 中配置好 <code>vue-loader</code> 即可：</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// webpack.config.js</span><br><br>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span><br>  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">'./app.js'</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'./build'</span><span class="token punctuation">,</span><br>    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'app.js'</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token literal-property property">loaders</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>      <span class="token punctuation">{</span><br>        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.vue$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'vue-loader'</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">]</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>这样，就可以正常地在文件中 <code>require()</code> 所有 <code>.vue</code> 文件：</p>
<pre class="language-javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span><br>    <span class="token literal-property property">el</span><span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span><br>    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">/* ... */</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>      <span class="token string-property property">'sample'</span><span class="token operator">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./components/sample.vue'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span></code></pre>
<h3 id="css-%E5%88%86%E7%A6%BB" tabindex="-1">css 分离</h3>
<p><code>vue-loader</code> 使用 <code>style-loader</code> 把 component 当中的样式编译成字符串后插入到 <code>&lt;head&gt;</code> 中去。但我们希望把 css 文件独立出去，那么可以使用上一篇文章提到的 <code>ExtractTextPlugin</code> 插件，配合 <code>vue-loader</code> 的 <code>withLoaders()</code> 方法实现生成独立样式文件：</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// webpack.config.js</span><br><span class="token keyword">var</span> vue <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'vue-loader'</span><span class="token punctuation">)</span><br>  <span class="token punctuation">,</span> ExtractTextPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"extract-text-webpack-plugin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span><br>  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">'./app.js'</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'./build'</span><span class="token punctuation">,</span><br>    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'app.js'</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token literal-property property">loaders</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>      <span class="token punctuation">{</span><br>        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.vue$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token literal-property property">loader</span><span class="token operator">:</span> vue<span class="token punctuation">.</span><span class="token function">withLoaders</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>          <span class="token literal-property property">sass</span><span class="token operator">:</span> ExtractTextPlugin<span class="token punctuation">.</span><span class="token function">extract</span><span class="token punctuation">(</span><span class="token string">"css!sass"</span><span class="token punctuation">)</span> <span class="token comment">// 编译 Sass</span><br>        <span class="token punctuation">}</span><span class="token punctuation">)</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">]</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>    <span class="token keyword">new</span> <span class="token class-name">ExtractTextPlugin</span><span class="token punctuation">(</span><span class="token string">'app.css'</span><span class="token punctuation">)</span> <span class="token comment">// 输出到 output path 下的 app.css 文件</span><br>  <span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre>
<h2 id="%E6%80%BB%E7%BB%93" tabindex="-1">总结</h2>
<p>webpack 是一个十分好用的模块打包工具，使用它更加利于实现前端开发工程化。</p>
<p>很多人认为 webpack 可以取代 Gulp/Grunt 等构建工具，其实不然。Webpack 仅仅是<strong>顺便</strong>替构建工具分担了一些预编译预处理的工作，而构建工作不仅仅只有预编译啊。</p>
<p>Vue.js 和 Webpack 的结合使用方法写到这里就已经算是写完了，当然，还有很多其它的实践方法，都要靠读者自己去摸索了，这个系列仅仅是想给没有使用过 Vue.js 或者 Webpack 的读者一个大概的认识。</p>
<p>最后趁这个机会感慨一下，前端开发是让人感到兴奋的，我以前也写很多有关前端的东西，但从来不愿意称自己为『前端开发者』，是由于自己对前端开发的各种浅见，认为前端开发低端、repetitive、不能成大事。但是经过更加深入的实践，才慢慢发现前端也是工程化的、有学问的、有活力的。我很高兴可以作为一名『前端开发者』，在这里感受日新月异的氛围的技术浪潮。</p>
<h2 id="%E5%BB%B6%E4%BC%B8%E9%98%85%E8%AF%BB" tabindex="-1">延伸阅读</h2>
<ul>
<li><a href="https://github.com/fouber/blog/issues/10">前端工程——基础篇</a></li>
<li><a href="http://webpack.github.io/docs/tutorials/getting-started/">Webpack Getting Started</a></li>
<li><a href="http://segmentfault.com/a/1190000002551952">Webpack 入门指迷</a></li>
<li><a href="https://www.youtube.com/watch?v=VkTCL6Nqm6Y">How Instagram.com Works</a></li>
<li><a href="http://vuejs.org/guide/components.html">Vue.js - Component System</a></li>
<li><a href="http://vuejs.org/guide/application.html">Vue.js - Building Larger Apps</a></li>
<li><a href="https://github.com/vuejs/vue-router">vue-router</a></li>
<li><a href="http://teahour.fm/2015/08/16/vuejs-creator-evan-you.html">和 Vue.js 框架的作者聊聊前端框架开发背后的故事</a></li>
</ul>

    </div>
    <hr />
      <div class="text-sm text-center">
        评论和交流请发送邮件到 hi@taonan.lu
      </div>
      <hr />
    <div class="text-center">
  <img class="w-64 inline-block" src="https://i.loli.net/2021/10/20/JZ26YwDhmGzUy4u.jpg" alt="" />
  <div class="text-sm">
    通过支付宝 djyde520@gmail.com 或赞赏码赞助此文
  </div>
</div>
    <footer class="text-sm py-12 text-gray-500 text-center">
  Tsja's Blog since 2023
</footer>

  </div>

</div>



</body>
</html>